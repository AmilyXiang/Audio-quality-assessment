# NISQA æ„ŸçŸ¥è´¨é‡åˆ†æå·¥å…·

åŸºäºæ·±åº¦å­¦ä¹ çš„è¯­éŸ³è´¨é‡è¯„ä¼°ï¼Œä½¿ç”¨ [NISQA](https://github.com/gabrielmittag/NISQA) æ¨¡å‹è¿›è¡Œå¸§çº§æ—¶åºåˆ†æã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- **MOSè¯„åˆ†** (1-5åˆ†)ï¼šMean Opinion Scoreï¼Œæ¨¡æ‹Ÿäººç±»ä¸»è§‚æ„ŸçŸ¥
- **å¤šç»´åº¦åˆ†æ**ï¼š
  - NOI (Noisiness): å™ªå£°ç¨‹åº¦
  - DIS (Discontinuity): ä¸è¿ç»­æ€§/å¡é¡¿
  - COL (Coloration): éŸ³è‰²å¤±çœŸ
  - LOUD (Loudness): å“åº¦é€‚ä¸­æ€§
- **å¸§çº§æ—¶åºåˆ†æ**ï¼š0.5ç§’ç²¾åº¦çš„è´¨é‡å˜åŒ–è¿½è¸ª
- **å¯è§†åŒ–è¾“å‡º**ï¼šäº”ç»´åº¦æ—¶åºæ›²çº¿å›¾

## å¿«é€Ÿå¼€å§‹

### 1. ä¸‹è½½æ¨¡å‹ï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰

```bash
# è‡ªåŠ¨ä¸‹è½½NISQAé¢„è®­ç»ƒæ¨¡å‹ï¼ˆ~100MBï¼‰
python download_nisqa_model.py

# æˆ–æ‰‹åŠ¨ä¸‹è½½ï¼š
# https://github.com/gabrielmittag/NISQA/releases
# å°† nisqa.tar æ”¾åˆ° weights/ ç›®å½•
```

### 2. å¸§çº§æ—¶åºåˆ†æï¼ˆæ¨èï¼‰

```bash
# ä½¿ç”¨é»˜è®¤æœ€ä¼˜é…ç½®ï¼ˆ15sçª—å£ï¼Œ0.5sè·³è·ƒï¼‰
python analyze_nisqa_framewise.py --audio ../path/to/audio.wav --model weights/nisqa.tar --plot
```

**è¾“å‡º**ï¼š
- `framewise_<filename>.png` - äº”ç»´åº¦æ—¶åºæ›²çº¿å›¾
- `framewise_<filename>.json` - è¯¦ç»†å¸§çº§æ•°æ®

### 3. æ ‡å‡†æ–‡ä»¶çº§åˆ†æ

```bash
# ä»…è·å–æ•´ä½“è´¨é‡è¯„åˆ†
python analyze_nisqa.py --audio ../path/to/audio.wav --model weights/nisqa.tar
```

### 4. åŸºå‡†å¯¹æ¯”åˆ†æï¼ˆå¤šæ–‡ä»¶ï¼‰

ä½¿ç”¨åŸºå‡†éŸ³é¢‘å¯¹å¤šä¸ªæµ‹è¯•éŸ³é¢‘è¿›è¡Œé€å¸§å¯¹æ¯”ï¼Œè¾“å‡ºå•æ–‡ä»¶å¯¹æ¯”å›¾ã€JSONç»“æœï¼Œä»¥åŠå¤šæ–‡ä»¶æ±‡æ€»å›¾ã€‚

```bash
# æ‰«æç›®å½•ä¸­çš„æ‰€æœ‰wavï¼ˆè‡ªåŠ¨æ’é™¤baselineï¼‰
python analyze_nisqa_baseline_compare.py \
  --baseline ../robotic/1010baseline.wav \
  --test-dir ../robotic/tst \
  --model weights/nisqa.tar \
  --clean
```

**å…³é”®å‚æ•°**ï¼š
- `--output_dir`ï¼šè¾“å‡ºç›®å½•ï¼ˆé»˜è®¤ï¼šæµ‹è¯•å½•éŸ³æ‰€åœ¨ç›®å½•ï¼‰
- `--keep-framewise`ï¼šä¿ç•™ `framewise_*.json` ä¸­é—´æ–‡ä»¶ï¼ˆé»˜è®¤ä¼šè‡ªåŠ¨æ¸…ç†ï¼‰
- `--clean`ï¼šæ¸…ç† `baseline_compare_*.png/.json` ä¸´æ—¶ç»“æœï¼Œä»…ä¿ç•™ï¼š
  - `baseline_compare_all.png`
  - `baseline_compare_heatmap.png`
  - `baseline_compare_all.json`ï¼ˆå¦‚å­˜åœ¨ï¼‰
  - `baseline_compare_heatmap.json`ï¼ˆå¦‚å­˜åœ¨ï¼‰
- `--generate-excel`ï¼šç”Ÿæˆé—®é¢˜æ–‡ä»¶ Excel æŠ¥å‘Šï¼ˆé»˜è®¤æ–‡ä»¶åï¼š`result.xlsx`ï¼‰

**è¾“å‡ºè¯´æ˜**ï¼š
- å•æ–‡ä»¶ç»“æœï¼š`baseline_compare_<testname>.png/.json`
- æ±‡æ€»ç»“æœï¼š`baseline_compare_all.png`ã€`baseline_compare_heatmap.png`

## æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | åŠŸèƒ½ | æ¨èåº¦ |
|------|------|--------|
| `analyze_nisqa_framewise.py` | å¸§çº§æ—¶åºåˆ†æï¼Œæ”¯æŒé—®é¢˜å®šä½ | â­â­â­â­â­ |
| `analyze_nisqa.py` | æ ‡å‡†NISQAåˆ†æï¼Œä»…æ–‡ä»¶çº§è¯„åˆ† | â­â­â­ |
| `analyze_nisqa_baseline_compare.py` | åŸºå‡†å¯¹æ¯”åˆ†æï¼ˆæ”¯æŒå¤šæ–‡ä»¶ã€æ±‡æ€»å›¾ã€ä¸´æ—¶æ–‡ä»¶æ¸…ç†ï¼‰ | â­â­â­â­â­ |
| `nisqa_full_analysis.py` | å®Œæ•´åˆ†æï¼ˆåŒ…å«æ‰€æœ‰æ¨¡å¼ï¼‰ | â­â­â­â­ |
| `download_nisqa_model.py` | æ¨¡å‹ä¸‹è½½å·¥å…· | ğŸ”§ |

## é…ç½®å‚æ•°

### çª—å£é•¿åº¦ (seg_length)

| é…ç½® | å¸§æ•° | ç²¾åº¦ | æ¨èåº¦ |
|------|------|------|--------|
| **15s** (é»˜è®¤) | 28 | æœ€é«˜ | â­â­â­â­â­ |
| 13s | 32 | -1.6% | â­â­â­â­ |
| 11s | 36 | -6.7% | â­â­ |

**è¯´æ˜**ï¼šNISQAæ¨¡å‹åœ¨15ç§’çª—å£ä¸Šè®­ç»ƒï¼Œåç¦»æ­¤çª—å£ä¼šé™ä½å‡†ç¡®æ€§ã€‚

### è·³è·ƒæ­¥é•¿ (hop_length)

| é…ç½® | æ—¶é—´åˆ†è¾¨ç‡ | æ¨èåœºæ™¯ |
|------|-----------|---------|
| **0.5s** (é»˜è®¤) | é«˜åˆ†è¾¨ç‡ | è´¨é‡é—®é¢˜å®šä½ |
| 1.0s | æ ‡å‡†åˆ†è¾¨ç‡ | å¿«é€Ÿæ¦‚è§ˆ |
| 0.25s | æé«˜åˆ†è¾¨ç‡ | ç»†ç²’åº¦åˆ†æï¼ˆè®¡ç®—é‡å¤§ï¼‰ |

## ç¤ºä¾‹è¾“å‡º

### æ§åˆ¶å°

```
File-Level Quality (Aggregated):
  MOS:        4.54  â† æ€»ä½“è´¨é‡ä¼˜ç§€
  Noisiness:  4.30  â† å™ªå£°ä½
  Distortion: 4.48  â† å‡ ä¹æ— å¤±çœŸ
  Coloration: 4.33  â† éŸ³è‰²è‡ªç„¶
  Loudness:   4.50  â† å“åº¦é€‚ä¸­

Frame-Level Quality (28 frames):
  Frame 1 [0.0s - 15.0s]: MOS: 4.64
  Frame 2 [0.5s - 15.5s]: MOS: 4.62
  ...
  Frame 27 [13.0s - 28.0s]: MOS: 1.85  â† æ£€æµ‹åˆ°è´¨é‡ä¸‹é™
```

### JSON

```json
{
  "audio_file": "audio.wav",
  "file_level": {
    "mos": 4.541,
    "noi": 4.301,
    "dis": 4.481,
    "col": 4.331,
    "loud": 4.501
  },
  "frame_level": {
    "total_frames": 28,
    "seg_length": 15.0,
    "hop_length": 0.5,
    "frames": [...]
  }
}
```

## è´¨é‡è¯„åˆ†å‚è€ƒ

| MOSèŒƒå›´ | è´¨é‡ç­‰çº§ | æè¿° |
|---------|---------|------|
| 4.5-5.0 | ä¼˜ç§€ (Excellent) | å‡ ä¹å®Œç¾ |
| 4.0-4.5 | è‰¯å¥½ (Good) | é«˜è´¨é‡ |
| 3.0-4.0 | ä¸­ç­‰ (Fair) | å¯æ¥å— |
| 2.0-3.0 | å·® (Poor) | æ˜æ˜¾é—®é¢˜ |
| 1.0-2.0 | æå·® (Bad) | ä¸¥é‡åŠ£åŒ– |

## é—®é¢˜è¯Šæ–­

### å¤šç»´åº¦æŒ‡æ ‡è§£è¯»

- **NOI < 3.0**: èƒŒæ™¯å™ªå£°é—®é¢˜æˆ–å½•éŸ³è®¾å¤‡å¹²æ‰°
- **DIS < 3.0**: ç½‘ç»œä¸¢åŒ…ã€å¡é¡¿ã€æ–­ç»­
- **COL < 3.0**: ç¼–è§£ç å¤±çœŸã€åˆæˆéŸ³ç‰¹å¾ã€éŸ³è‰²å¼‚å¸¸
- **LOUD < 3.0**: éŸ³é‡è¿‡å¤§/è¿‡å°ã€å¢ç›Šè®¾ç½®ä¸å½“

### æ»‘åŠ¨çª—å£å®šä½æ³•

é€šè¿‡è¿ç»­å¸§çš„MOSå˜åŒ–å®šä½é—®é¢˜æ—¶é—´æ®µï¼š

```
Frame N   [t - t+15s]    MOS: 4.5
Frame N+1 [t+0.5 - t+15.5s]  MOS: 3.2  â† ä¸‹é™
Frame N+2 [t+1.0 - t+16.0s]  MOS: 2.8  â† ç»§ç»­ä¸‹é™

ç»“è®ºï¼šæ–°å¢æ®µ [t+15s - t+16s] è´¨é‡æ¶åŒ–
```

æ¯ä¸ªå¸§æœ‰96.7%çš„å†…å®¹ä¸å‰ä¸€å¸§é‡å ï¼Œå·®å¼‚ä»…ä¸º0.5ç§’çš„æ–°å¢æ®µã€‚MOSå˜åŒ–å³å¯åæ˜ æ–°å¢æ®µçš„è´¨é‡ã€‚

## æ³¨æ„äº‹é¡¹

1. **é¦–æ¬¡è¿è¡Œéœ€ä¸‹è½½æ¨¡å‹**ï¼ˆ~100MBï¼‰
2. **æ¨¡å‹å’Œç¬¬ä¸‰æ–¹åº“ä¸åœ¨Gitä»“åº“**ï¼Œéœ€æœ¬åœ°ä¸‹è½½
3. **è¾“å‡ºæ–‡ä»¶ï¼ˆ.png/.jsonï¼‰ä¸åº”æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶**
4. æ¨èä½¿ç”¨é»˜è®¤15s/0.5sé…ç½®ä»¥è·å¾—æœ€ä½³ç²¾åº¦

## æŠ€æœ¯ç»†èŠ‚

- æ¨¡å‹ï¼šNISQA (Non-Intrusive Speech Quality Assessment)
- è®­ç»ƒçª—å£ï¼š15ç§’
- é‡‡æ ·ç‡æ”¯æŒï¼š8kHz - 48kHz
- è¾“å…¥æ ¼å¼ï¼šWAVï¼ˆéœ€librosaæ”¯æŒçš„æ ¼å¼ï¼‰
- Melé¢‘è°±å‚æ•°ï¼šn_fft=4096, n_mels=48, hop_length=0.01s

## å‚è€ƒèµ„æ–™

- [NISQA GitHub](https://github.com/gabrielmittag/NISQA)
- [NISQAè®ºæ–‡](https://arxiv.org/abs/2104.09494)
- [ITU-T P.863 (POLQA)](https://www.itu.int/rec/T-REC-P.863)
